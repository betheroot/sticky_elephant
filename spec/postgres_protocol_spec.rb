require "spec_helper"

describe StickyElephant::PostgresSimulator do
  let(:version_sim) { StickyElephant::PostgresSimulator.new("SELECT version();") }
  it "Should respond with the version" do
    expected = [0x54, 0x00, 0x00, 0x00, 0x20, 0x00, 0x01, 0x76, 0x65, 0x72,
                0x73, 0x69, 0x6F, 0x6E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x19, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
                0xFF, 0x00, 0x00, 0x44, 0x00, 0x00, 0x00, 0x69, 0x00, 0x01,
                0x00, 0x00, 0x00, 0x5F, 0x50, 0x6F, 0x73, 0x74, 0x67, 0x72,
                0x65, 0x53, 0x51, 0x4C, 0x20, 0x39, 0x2E, 0x35, 0x2E, 0x35,
                0x20, 0x6F, 0x6E, 0x20, 0x78, 0x38, 0x36, 0x5F, 0x36, 0x34,
                0x2D, 0x70, 0x63, 0x2D, 0x6C, 0x69, 0x6E, 0x75, 0x78, 0x2D,
                0x67, 0x6E, 0x75, 0x2C, 0x20, 0x63, 0x6F, 0x6D, 0x70, 0x69,
                0x6C, 0x65, 0x64, 0x20, 0x62, 0x79, 0x20, 0x67, 0x63, 0x63,
                0x20, 0x28, 0x55, 0x62, 0x75, 0x6E, 0x74, 0x75, 0x20, 0x34,
                0x2E, 0x38, 0x2E, 0x32, 0x2D, 0x31, 0x39, 0x75, 0x62, 0x75,
                0x6E, 0x74, 0x75, 0x31, 0x29, 0x20, 0x34, 0x2E, 0x38, 0x2E,
                0x32, 0x2C, 0x20, 0x36, 0x34, 0x2D, 0x62, 0x69, 0x74, 0x43,
                0x00, 0x00, 0x00, 0x0D, 0x53, 0x45, 0x4C, 0x45, 0x43, 0x54,
                0x20, 0x31, 0x00, 0x5A, 0x00, 0x00, 0x00, 0x05, 0x49].pack("C*")
    expect(version_sim.response).to eq expected
  end
end
